---
include:
  default:
    - profile::base::common
    - profile::base::firewall
  kickstart:
    - profile::base::common
  bootstrap:
    - profile::base::common
    - profile::base::firewall

#
# Location metadata
#
location_description: unset
location_environment: unset
location_tag:         unset

domain_public:        "%{::domain}"
domain_trp:           "%{::domain}"
domain_mgmt:          "%{::domain}"

openstack_version:    'mitaka'

valid_location_tags:
  - bgo
  - osl
  - trd
  - test01
  - test02
  - vagrant
  - dev01
  - dev02
  - local1
  - local3
valid_location_environments:
  - prod
  - dev

#
# Use this for firewall rules to allow only from some networks
#
allow_from_network:
  - '129.177.0.0/16'
  - '129.240.0.0/16'
  - '158.37.63.0/24'
  - '158.39.77.0/24'
  - '158.38.62.0/23'
  - '158.38.178.0/24'
  - '129.240.6.13/32'
  - '129.240.6.14/32'
  - '129.177.10.189/32' # tor
  - '129.177.10.212/32' # raymond
  - '158.36.0.0/16'
  - '128.39.0.0/16'
  - '129.177.6.133/32' #bgo-login
  - '129.240.224.100/32' #osl-login

#
# Default interfaces
#
named_interfaces::config:
  mgmt:
    - eth0
  transport: #FIXME
    - eth1
  trp:
    - eth1
  service: #FIXME
    - eth1
  public:
    - dummy0

#
# Public addresses
#
public__address__api:             "api.%{hiera('domain_public')}"
public__address__dashboard:       "dashboard.%{hiera('domain_public')}"
public__address__access:          "access.%{hiera('domain_public')}"
public__address__console:         "console.%{hiera('domain_public')}"

#
# Services (internal non openstack services)
#
service__address__db_01:          "db01.%{hiera('domain_trp')}"
service__address__db_02:          "db02.%{hiera('domain_trp')}"
service__address__status:         "status.%{hiera('domain_trp')}"
service__address__rabbitmq_01:    "mq01.%{hiera('domain_trp')}"
service__address__rabbitmq_02:    "mq01.%{hiera('domain_trp')}"
service__address__rabbitmq_03:    "mq01.%{hiera('domain_trp')}"

#
# Management (proxy and logger must be IP)
#
mgmt__address__proxy:             '0.0.0.0/32'
mgmt__address__logger:            '0.0.0.0/32'
mgmt__address__monitor:           "monitor.%{hiera('domain_mgmt')}"

#
# Endpoints (including protocole)
#
endpoint__identity__admin:        "http://identity.%{hiera('domain_trp')"
endpoint__identity__internal:     "http://identity.%{hiera('domain_trp')"
endpoint__identity__public:       "https://identity.api.%{hiera('domain_public')}"
endpoint__compute__admin:         "http://compute.%{hiera('domain_trp')"
endpoint__compute__internal:      "http://compute.%{hiera('domain_trp')"
endpoint__compute__public:        "https://compute.api.%{hiera('domain_public')}"
endpoint__volume__admin:          "http://volume.%{hiera('domain_trp')"
endpoint__volume__internal:       "http://volume.%{hiera('domain_trp')"
endpoint__volume__public:         "https://volume.api.%{hiera('domain_public')}"
endpoint__image__admin:           "http://image.%{hiera('domain_trp')"
endpoint__image__internal:        "http://image.%{hiera('domain_trp')"
endpoint__image__public:          "https://image.api.%{hiera('domain_public')}"
endpoint__network__admin:         "http://network.%{hiera('domain_trp')"
endpoint__network__internal:      "http://network.%{hiera('domain_trp')"
endpoint__network__public:        "https://api.network.%{hiera('domain_public')}"




# API endpint protocole
#endpoint_protocol: 'http' #FIXME

#
# Openstack services
#

# public
#service__address__status:            "status.%{hiera('domain_public')}"
#service__address__horizon:           "dashboard.%{hiera('domain_public')}"
#service__address__keystone_public:   "dashboard.%{hiera('domain_public')}"
#service__address__glance_public_api: "dashboard.%{hiera('domain_public')}"
#service__address__nova_public_api:   "dashboard.%{hiera('domain_public')}"
#service__address__neutron_public:    "dashboard.%{hiera('domain_public')}"
#service__address__cinder_public_api: "dashboard.%{hiera('domain_public')}"
#service__address__consoleproxy:      "console.%{hiera('domain_public')}"

# transport
#service__address__nova_api:          "novactrl.%{hiera('domain_trp')}"
#service__address__nova_api_metadata: '127.0.0.1'
#service__address__glance_registry:   "image.%{hiera('domain_trp')}"
#service__address__glance_api:        "image.%{hiera('domain_trp')}"
#service__address__keystone:          "identity.%{hiera('domain_trp')}"
#service__address__keystone_admin:    "identity.%{hiera('domain_trp')}"
#service__address__etcd_cluster:      "network.%{hiera('domain_trp')}"
#service__address__neutron_server:    "network.%{hiera('domain_trp')}"
#service__address__cinder_api:        "volume.%{hiera('domain_trp')}"
#service__address__mysql:             "db.%{hiera('domain_trp')}"
#service__address__rabbitmq_01:       "mq01.%{hiera('domain_trp')}"
#service__address__rabbitmq_02:       "mq01.%{hiera('domain_trp')}"
#service__address__rabbitmq_03:       "mq01.%{hiera('domain_trp')}"

# mgmt
#service__address__rsyslog:           "logger.%{hiera('domain_mgmt')}"
#service__address__proxy:             "proxy.%{hiera('domain_mgmt')}"
#service__address__monitor:           "monitor.%{hiera('domain_mgmt')}"

#
# Network configuration data
#
networks:
  bgo:
    domain:
      mgmt: mgmt.iaas.intern
      oob: oob.iaas.intern
    subnet:
      mgmt: 172.16.0.1/21
      oob: 172.17.0.1/21
    dhcp:
      mgmt:
        ensure: absent
      oob:
        ensure: present
        interface: eth2
        start_offset: 100
        end_offset: 199
        lease: 43200
    nat:
      mgmt:
        ensure: present
      oob:
        ensure: present
  osl:
    domain:
      mgmt: iaas.uio.no
      oob: iaas.uio.no
    subnet:
      mgmt: 172.16.32.0/21
      oob: 172.17.32.0/21
    dhcp:
      mgmt:
        ensure: absent
      oob:
        ensure: absent
    nat:
      mgmt:
        ensure: absent
      oob:
        ensure: absent
  trd:
    domain:
      mgmt: iaas.ntnu.no
      oob: oob.iaas.ntnu.no
    subnet:
      mgmt: 10.171.91.1/24
      oob: 10.171.86.1/24
    dhcp:
      mgmt:
        ensure: absent
      oob:
        ensure: present
        interface: eth2
        start_offset: 100
        end_offset: 199
        lease: 43200
    nat:
      mgmt:
        ensure: present
      oob:
        ensure: present
  test01:
    domain:
      mgmt: mgmt.test.iaas.intern
    subnet:
      mgmt: 172.28.0.0/24
    dhcp:
      mgmt:
        ensure: absent
    nat:
      mgmt:
        ensure: present
      oob:
        ensure: present
  test02:
    domain:
      mgmt: iaas.uio.no
    subnet:
      mgmt: 172.28.32.0/24
    dhcp:
      mgmt:
        ensure: absent
    nat:
      mgmt:
        ensure: present
      oob:
        ensure: present
  vagrant:
    domain:
      mgmt: himlar.local
    subnet:
      mgmt: 10.0.3.1/24
      oob: 10.0.4.1/24
    dhcp:
      mgmt:
        ensure: absent
      oob:
        ensure: present
        interface: eth1
        start_offset: 100
        end_offset: 199
        lease: 43200
    nat:
      mgmt:
        ensure: present
      oob:
        ensure: present
  dev01:
    domain:
      mgmt: mgmt.dev.iaas.intern
    subnet:
      mgmt: 172.31.1.0/24
    dhcp:
      mgmt:
        ensure: absent
      oob:
        ensure: absent
    nat:
      mgmt:
        ensure: absent
      oob:
        ensure: absent
  dev02:
    domain:
      mgmt: dev.iaas.ntnu.no
      oob: oob.iaas.ntnu.no
    subnet:
      mgmt: 10.171.92.1/24
      oob: 10.171.93.1/24
    dhcp:
      mgmt:
        ensure: absent
      oob:
        ensure: present
        interface: eth2
        start_offset: 100
        end_offset: 199
        lease: 43200
  local1:
    domain:
      mgmt: mgmt.local.iaas.intern
    subnet:
      mgmt: 172.31.4.0/24
    dhcp:
      mgmt:
        ensure: present
        inferface: eth0
        start_offset: 150
        end_offset: 199
        lease: 43200
    nat:
      mgmt:
        ensure: present
        iniface: eth0
        outiface: eth1
  local2:
    domain:
      mgmt: mgmt.local.iaas.intern
    subnet:
      mgmt: 172.31.5.0/24
    dhcp:
      mgmt:
        ensure: present
        inferface: eth0
        start_offset: 150
        end_offset: 199
        lease: 43200
    nat:
      mgmt:
        ensure: present
        iniface: eth0
        outiface: eth1
  local3:
    domain:
      mgmt: mgmt.local3.intern
    subnet:
      mgmt: 172.31.4.0/24
    dhcp:
      mgmt:
        ensure: present
        inferface: eth0
        start_offset: 150
        end_offset: 199
        lease: 43200
    nat:
      mgmt:
        ensure: present
        iniface: eth1
        outiface: eth0
